# 礼包兑换码(RedeemCode)系统

## 基本说明

策划需求[文档](http://wiki.taiyouxi.net/w/%E8%BF%90%E8%90%A5_%E7%A4%BE%E5%8C%BA/%E8%BF%90%E8%90%A5%E6%B4%BB%E5%8A%A8/%E7%A4%BC%E5%8C%85%E5%85%91%E6%8D%A2%E7%A0%81/)

礼包兑换码(RedeemCode)是由运营部分拟定，拿给渠道进行分发的可以领取指定奖品的编码。


### 术语

- 批号:
一般根据重大节日或随运营活动而分，譬如“五一大礼包”，“中秋送好礼”，或“首次公测礼包”等。
同一个账号只能激活并兑换一条来自同一批的兑换码。譬如，一个玩家使用了一个中秋送好礼的兑换码，就不能再使用另一个。

- 组号:
同一批内的礼包可以分组，用于保留给不同渠道提供不同礼包的自由度。譬如，同样是“五一大礼包”，360的礼包会奖励一个金装，但百度的礼包可能奖励很多钻。

- 内容:
一个批号和一个组号确定一个礼包。
一个礼包对应若干奖励内容，可以是货币，也可以是物品。

- 有效期:
礼包的有效期定义在批号里。

- 兑换码:
系统针对批号和组号来生成一组兑换码。
同一组兑换码中每个码都只能兑换对应批和对应组的礼包。

### 使用Case
- 尝试领取已经过期的礼包会被告知“该礼包已经过期”；
- 尝试领取有效期尚未开始的礼包会被告知“兑换活动尚未开始”；
- 尝试使用用过的兑换码会被告知“该兑换码已被用过，已经失效”；
- 在领过该批礼包后尝试使用同一批另一组的兑换码，会被告知“你已经领取过XXX大礼包，不能再领”。

### 生成

- 比如 小米 360 之类，要求很大，可能一个批次上万都有可能
- 格式的话给渠道，一般是TXT   、EXCEL

## 技术实现

一个RedeemCode = 批号+组号+随机串

利用DynamoDB数据库，使用KV模式

Code:批号组号随机串
Value:Json内容
Date: 有效期定义
State: New|Done|OutdatedDone
DoneBy: 用户gid:sid:uuid
bind: gid, gid:sid,

尽管，一个批次内的奖励内容都是相同的，我们简单的通过批量生成到数据库时，填写礼包完整内容的方式进行处理。
